{"ast":null,"code":"var _s = $RefreshSig$();\n// src/hooks/useWebRTC.js\nimport { useEffect, useRef, useState } from \"react\";\nexport default function useWebRTC(callId, {\n  timeout = 30000,\n  start = true,\n  isInitiator = false\n}) {\n  _s();\n  const wsRef = useRef();\n  const pcRef = useRef();\n  const dataChannelRef = useRef();\n  const remoteAudioRef = useRef();\n  const localStreamRef = useRef();\n  const [status, setStatus] = useState(\"waiting\");\n  const statusRef = useRef(status);\n  useEffect(() => {\n    statusRef.current = status;\n  }, [status]);\n  const [chatMessages, setChatMessages] = useState([]);\n  const [localSpeaking, setLocalSpeaking] = useState(false);\n  const [remoteSpeaking, setRemoteSpeaking] = useState(false);\n  const [remoteMuted, setRemoteMuted] = useState(false);\n\n  // 1) Signaling\n  useEffect(() => {\n    if (!start) return;\n    const serverUrl = process.env.REACT_APP_SERVER_URL;\n    const ws = new WebSocket(`${serverUrl.replace(/^http/, \"ws\")}?roomId=${callId}`);\n    wsRef.current = ws;\n    ws.onopen = () => console.log(\"WS open\");\n    ws.onclose = () => console.log(\"WS closed\");\n    ws.onmessage = async ({\n      data\n    }) => {\n      let msg;\n      try {\n        msg = JSON.parse(data);\n      } catch {\n        return;\n      }\n      switch (msg.type) {\n        case \"room-status\":\n          // seul l’initiateur lance l’offre quand peers=2\n          if (msg.peers === 2 && isInitiator && statusRef.current === \"waiting\") {\n            await initiateCall(true);\n          }\n          break;\n        case \"offer\":\n          // invité : on crée le PC *au premier* offer\n          if (!pcRef.current) {\n            await initiateCall(false);\n          }\n          await pcRef.current.setRemoteDescription(msg.offer);\n          const answer = await pcRef.current.createAnswer();\n          await pcRef.current.setLocalDescription(answer);\n          ws.send(JSON.stringify({\n            type: \"answer\",\n            answer\n          }));\n          break;\n        case \"answer\":\n          await pcRef.current.setRemoteDescription(msg.answer);\n          break;\n        case \"candidate\":\n          await pcRef.current.addIceCandidate(msg.candidate);\n          break;\n        case \"peer-left\":\n          setStatus(\"peer-left\");\n          break;\n        case \"call-ended\":\n          setStatus(\"ended\");\n          break;\n      }\n    };\n    const timer = setTimeout(() => {\n      if (statusRef.current !== \"connected\") setStatus(\"timeout\");\n    }, timeout);\n    return () => {\n      var _pcRef$current;\n      clearTimeout(timer);\n      ws.close();\n      (_pcRef$current = pcRef.current) === null || _pcRef$current === void 0 ? void 0 : _pcRef$current.close();\n    };\n  }, [callId, start, isInitiator]);\n\n  // 2) Création du PeerConnection + Tracks\n  async function initiateCall(offerer) {\n    setStatus(\"connecting\");\n    const pc = new RTCPeerConnection({\n      iceServers: [{\n        urls: process.env.REACT_APP_STUN_SERVER\n      }]\n    });\n    pcRef.current = pc;\n\n    // a) getUserMedia\n    localStreamRef.current = await navigator.mediaDevices.getUserMedia({\n      audio: true\n    });\n    localStreamRef.current.getTracks().forEach(t => pc.addTrack(t, localStreamRef.current));\n\n    // b) détection de la parole locale\n    const ctxL = new (window.AudioContext || window.webkitAudioContext)();\n    const anL = ctxL.createAnalyser();\n    ctxL.createMediaStreamSource(localStreamRef.current).connect(anL);\n    anL.fftSize = 256;\n    const bufL = new Uint8Array(anL.frequencyBinCount);\n    (function detectL() {\n      anL.getByteFrequencyData(bufL);\n      setLocalSpeaking(bufL.reduce((a, v) => a + v, 0) / bufL.length > 30);\n      requestAnimationFrame(detectL);\n    })();\n\n    // c) réception du flux distant\n    pc.ontrack = ({\n      streams: [stream]\n    }) => {\n      if (remoteAudioRef.current) {\n        remoteAudioRef.current.srcObject = stream;\n        remoteAudioRef.current.play().catch(() => {}); // relancez la lecture si bloquée\n      }\n\n      // mute/unmute distant\n      const rt = stream.getAudioTracks()[0];\n      if (rt) {\n        rt.onmute = () => setRemoteMuted(true);\n        rt.onunmute = () => setRemoteMuted(false);\n      }\n\n      // détection de parole distante (une seule fois)\n      if (!remoteSpeaking) {\n        const ctxR = new (window.AudioContext || window.webkitAudioContext)();\n        const anR = ctxR.createAnalyser();\n        ctxR.createMediaStreamSource(stream).connect(anR);\n        anR.fftSize = 256;\n        const bufR = new Uint8Array(anR.frequencyBinCount);\n        (function detectR() {\n          anR.getByteFrequencyData(bufR);\n          setRemoteSpeaking(bufR.reduce((a, v) => a + v, 0) / bufR.length > 30);\n          requestAnimationFrame(detectR);\n        })();\n      }\n    };\n\n    // d) DataChannel (chat + mute)\n    if (offerer) {\n      dataChannelRef.current = pc.createDataChannel(\"chat\");\n      setupDataChannel();\n    } else {\n      pc.ondatachannel = ({\n        channel\n      }) => {\n        dataChannelRef.current = channel;\n        setupDataChannel();\n      };\n    }\n\n    // e) ICE candidates\n    pc.onicecandidate = ({\n      candidate\n    }) => {\n      if (candidate) wsRef.current.send(JSON.stringify({\n        type: \"candidate\",\n        candidate\n      }));\n    };\n\n    // f) offer / answer\n    if (offerer) {\n      const o = await pc.createOffer();\n      await pc.setLocalDescription(o);\n      wsRef.current.send(JSON.stringify({\n        type: \"offer\",\n        offer: o\n      }));\n    }\n    setStatus(\"connected\");\n  }\n  function setupDataChannel() {\n    const dc = dataChannelRef.current;\n    dc.onopen = () => console.log(\"DataChannel open\");\n    dc.onmessage = ({\n      data\n    }) => {\n      var _p;\n      let p;\n      try {\n        p = JSON.parse(data);\n      } catch {}\n      if (((_p = p) === null || _p === void 0 ? void 0 : _p.type) === \"mute\") {\n        setRemoteMuted(p.muted);\n      } else {\n        setChatMessages(prev => [...prev, {\n          sender: \"peer\",\n          text: data\n        }]);\n      }\n    };\n  }\n\n  // API publique\n  function sendMessage(text) {\n    const dc = dataChannelRef.current;\n    if ((dc === null || dc === void 0 ? void 0 : dc.readyState) === \"open\") {\n      dc.send(text);\n      setChatMessages(prev => [...prev, {\n        sender: \"local\",\n        text\n      }]);\n    }\n  }\n  function toggleMute() {\n    var _localStreamRef$curre, _dataChannelRef$curre;\n    const t = (_localStreamRef$curre = localStreamRef.current) === null || _localStreamRef$curre === void 0 ? void 0 : _localStreamRef$curre.getAudioTracks()[0];\n    if (!t) return;\n    t.enabled = !t.enabled;\n    const msg = JSON.stringify({\n      type: \"mute\",\n      muted: !t.enabled\n    });\n    ((_dataChannelRef$curre = dataChannelRef.current) === null || _dataChannelRef$curre === void 0 ? void 0 : _dataChannelRef$curre.readyState) === \"open\" && dataChannelRef.current.send(msg);\n  }\n  function hangUp() {\n    var _localStreamRef$curre2;\n    if (isInitiator) wsRef.current.send(JSON.stringify({\n      type: \"end-call\"\n    }));\n    setStatus(\"ended\");\n    (_localStreamRef$curre2 = localStreamRef.current) === null || _localStreamRef$curre2 === void 0 ? void 0 : _localStreamRef$curre2.getTracks().forEach(t => t.stop());\n    if (remoteAudioRef.current) remoteAudioRef.current.srcObject = null;\n    setTimeout(() => {\n      var _wsRef$current, _pcRef$current2;\n      (_wsRef$current = wsRef.current) === null || _wsRef$current === void 0 ? void 0 : _wsRef$current.close();\n      (_pcRef$current2 = pcRef.current) === null || _pcRef$current2 === void 0 ? void 0 : _pcRef$current2.close();\n    }, 100);\n  }\n  return {\n    remoteAudioRef,\n    status,\n    chatMessages,\n    sendMessage,\n    toggleMute,\n    hangUp,\n    localSpeaking,\n    remoteSpeaking,\n    remoteMuted\n  };\n}\n_s(useWebRTC, \"cKP1I0v2cUgvh4EjW4pVYio3St0=\");","map":{"version":3,"names":["useEffect","useRef","useState","useWebRTC","callId","timeout","start","isInitiator","_s","wsRef","pcRef","dataChannelRef","remoteAudioRef","localStreamRef","status","setStatus","statusRef","current","chatMessages","setChatMessages","localSpeaking","setLocalSpeaking","remoteSpeaking","setRemoteSpeaking","remoteMuted","setRemoteMuted","serverUrl","process","env","REACT_APP_SERVER_URL","ws","WebSocket","replace","onopen","console","log","onclose","onmessage","data","msg","JSON","parse","type","peers","initiateCall","setRemoteDescription","offer","answer","createAnswer","setLocalDescription","send","stringify","addIceCandidate","candidate","timer","setTimeout","_pcRef$current","clearTimeout","close","offerer","pc","RTCPeerConnection","iceServers","urls","REACT_APP_STUN_SERVER","navigator","mediaDevices","getUserMedia","audio","getTracks","forEach","t","addTrack","ctxL","window","AudioContext","webkitAudioContext","anL","createAnalyser","createMediaStreamSource","connect","fftSize","bufL","Uint8Array","frequencyBinCount","detectL","getByteFrequencyData","reduce","a","v","length","requestAnimationFrame","ontrack","streams","stream","srcObject","play","catch","rt","getAudioTracks","onmute","onunmute","ctxR","anR","bufR","detectR","createDataChannel","setupDataChannel","ondatachannel","channel","onicecandidate","o","createOffer","dc","_p","p","muted","prev","sender","text","sendMessage","readyState","toggleMute","_localStreamRef$curre","_dataChannelRef$curre","enabled","hangUp","_localStreamRef$curre2","stop","_wsRef$current","_pcRef$current2"],"sources":["/Users/theodiamant/Desktop/webrtc/client/src/hooks/useWebRTC.js"],"sourcesContent":["// src/hooks/useWebRTC.js\nimport { useEffect, useRef, useState } from \"react\";\n\nexport default function useWebRTC(\n  callId,\n  { timeout = 30000, start = true, isInitiator = false }\n) {\n  const wsRef = useRef();\n  const pcRef = useRef();\n  const dataChannelRef = useRef();\n  const remoteAudioRef = useRef();\n  const localStreamRef = useRef();\n\n  const [status, setStatus] = useState(\"waiting\");\n  const statusRef = useRef(status);\n  useEffect(() => {\n    statusRef.current = status;\n  }, [status]);\n\n  const [chatMessages, setChatMessages] = useState([]);\n  const [localSpeaking, setLocalSpeaking] = useState(false);\n  const [remoteSpeaking, setRemoteSpeaking] = useState(false);\n  const [remoteMuted, setRemoteMuted] = useState(false);\n\n  // 1) Signaling\n  useEffect(() => {\n    if (!start) return;\n    const serverUrl = process.env.REACT_APP_SERVER_URL;\n    const ws = new WebSocket(\n      `${serverUrl.replace(/^http/, \"ws\")}?roomId=${callId}`\n    );\n    wsRef.current = ws;\n\n    ws.onopen = () => console.log(\"WS open\");\n    ws.onclose = () => console.log(\"WS closed\");\n\n    ws.onmessage = async ({ data }) => {\n      let msg;\n      try {\n        msg = JSON.parse(data);\n      } catch {\n        return;\n      }\n\n      switch (msg.type) {\n        case \"room-status\":\n          // seul l’initiateur lance l’offre quand peers=2\n          if (msg.peers === 2 && isInitiator && statusRef.current === \"waiting\") {\n            await initiateCall(true);\n          }\n          break;\n\n        case \"offer\":\n          // invité : on crée le PC *au premier* offer\n          if (!pcRef.current) {\n            await initiateCall(false);\n          }\n          await pcRef.current.setRemoteDescription(msg.offer);\n          const answer = await pcRef.current.createAnswer();\n          await pcRef.current.setLocalDescription(answer);\n          ws.send(JSON.stringify({ type: \"answer\", answer }));\n          break;\n\n        case \"answer\":\n          await pcRef.current.setRemoteDescription(msg.answer);\n          break;\n\n        case \"candidate\":\n          await pcRef.current.addIceCandidate(msg.candidate);\n          break;\n\n        case \"peer-left\":\n          setStatus(\"peer-left\");\n          break;\n        case \"call-ended\":\n          setStatus(\"ended\");\n          break;\n      }\n    };\n\n    const timer = setTimeout(() => {\n      if (statusRef.current !== \"connected\") setStatus(\"timeout\");\n    }, timeout);\n\n    return () => {\n      clearTimeout(timer);\n      ws.close();\n      pcRef.current?.close();\n    };\n  }, [callId, start, isInitiator]);\n\n  // 2) Création du PeerConnection + Tracks\n  async function initiateCall(offerer) {\n    setStatus(\"connecting\");\n    const pc = new RTCPeerConnection({\n      iceServers: [{ urls: process.env.REACT_APP_STUN_SERVER }],\n    });\n    pcRef.current = pc;\n\n    // a) getUserMedia\n    localStreamRef.current = await navigator.mediaDevices.getUserMedia({\n      audio: true,\n    });\n    localStreamRef.current\n      .getTracks()\n      .forEach((t) => pc.addTrack(t, localStreamRef.current));\n\n    // b) détection de la parole locale\n    const ctxL = new (window.AudioContext || window.webkitAudioContext)();\n    const anL = ctxL.createAnalyser();\n    ctxL.createMediaStreamSource(localStreamRef.current).connect(anL);\n    anL.fftSize = 256;\n    const bufL = new Uint8Array(anL.frequencyBinCount);\n    (function detectL() {\n      anL.getByteFrequencyData(bufL);\n      setLocalSpeaking(\n        bufL.reduce((a, v) => a + v, 0) / bufL.length > 30\n      );\n      requestAnimationFrame(detectL);\n    })();\n\n    // c) réception du flux distant\n    pc.ontrack = ({ streams: [stream] }) => {\n      if (remoteAudioRef.current) {\n        remoteAudioRef.current.srcObject = stream;\n        remoteAudioRef.current\n          .play()\n          .catch(() => {}); // relancez la lecture si bloquée\n      }\n\n      // mute/unmute distant\n      const rt = stream.getAudioTracks()[0];\n      if (rt) {\n        rt.onmute = () => setRemoteMuted(true);\n        rt.onunmute = () => setRemoteMuted(false);\n      }\n\n      // détection de parole distante (une seule fois)\n      if (!remoteSpeaking) {\n        const ctxR = new (window.AudioContext ||\n          window.webkitAudioContext)();\n        const anR = ctxR.createAnalyser();\n        ctxR.createMediaStreamSource(stream).connect(anR);\n        anR.fftSize = 256;\n        const bufR = new Uint8Array(anR.frequencyBinCount);\n        (function detectR() {\n          anR.getByteFrequencyData(bufR);\n          setRemoteSpeaking(\n            bufR.reduce((a, v) => a + v, 0) / bufR.length > 30\n          );\n          requestAnimationFrame(detectR);\n        })();\n      }\n    };\n\n    // d) DataChannel (chat + mute)\n    if (offerer) {\n      dataChannelRef.current = pc.createDataChannel(\"chat\");\n      setupDataChannel();\n    } else {\n      pc.ondatachannel = ({ channel }) => {\n        dataChannelRef.current = channel;\n        setupDataChannel();\n      };\n    }\n\n    // e) ICE candidates\n    pc.onicecandidate = ({ candidate }) => {\n      if (candidate)\n        wsRef.current.send(\n          JSON.stringify({ type: \"candidate\", candidate })\n        );\n    };\n\n    // f) offer / answer\n    if (offerer) {\n      const o = await pc.createOffer();\n      await pc.setLocalDescription(o);\n      wsRef.current.send(JSON.stringify({ type: \"offer\", offer: o }));\n    }\n\n    setStatus(\"connected\");\n  }\n\n  function setupDataChannel() {\n    const dc = dataChannelRef.current;\n    dc.onopen = () => console.log(\"DataChannel open\");\n    dc.onmessage = ({ data }) => {\n      let p;\n      try {\n        p = JSON.parse(data);\n      } catch {}\n      if (p?.type === \"mute\") {\n        setRemoteMuted(p.muted);\n      } else {\n        setChatMessages((prev) => [\n          ...prev,\n          { sender: \"peer\", text: data },\n        ]);\n      }\n    };\n  }\n\n  // API publique\n  function sendMessage(text) {\n    const dc = dataChannelRef.current;\n    if (dc?.readyState === \"open\") {\n      dc.send(text);\n      setChatMessages((prev) => [\n        ...prev,\n        { sender: \"local\", text },\n      ]);\n    }\n  }\n  function toggleMute() {\n    const t = localStreamRef.current?.getAudioTracks()[0];\n    if (!t) return;\n    t.enabled = !t.enabled;\n    const msg = JSON.stringify({ type: \"mute\", muted: !t.enabled });\n    dataChannelRef.current?.readyState === \"open\" &&\n      dataChannelRef.current.send(msg);\n  }\n  function hangUp() {\n    if (isInitiator)\n      wsRef.current.send(JSON.stringify({ type: \"end-call\" }));\n    setStatus(\"ended\");\n    localStreamRef.current?.getTracks().forEach((t) => t.stop());\n    if (remoteAudioRef.current)\n      remoteAudioRef.current.srcObject = null;\n    setTimeout(() => {\n      wsRef.current?.close();\n      pcRef.current?.close();\n    }, 100);\n  }\n\n  return {\n    remoteAudioRef,\n    status,\n    chatMessages,\n    sendMessage,\n    toggleMute,\n    hangUp,\n    localSpeaking,\n    remoteSpeaking,\n    remoteMuted,\n  };\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}