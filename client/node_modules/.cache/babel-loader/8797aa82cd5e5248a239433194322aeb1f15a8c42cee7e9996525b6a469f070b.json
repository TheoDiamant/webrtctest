{"ast":null,"code":"var _s = $RefreshSig$();\n// src/hooks/useWebRTC.js\nimport { useEffect, useRef, useState } from \"react\";\nexport default function useWebRTC(callId, {\n  timeout = 30000,\n  start = true,\n  isInitiator = false\n}) {\n  _s();\n  // --- refs & state ---\n  const wsRef = useRef();\n  const pcRef = useRef();\n  const dataChannelRef = useRef();\n  const remoteAudioRef = useRef();\n  const localStreamRef = useRef();\n  const [status, setStatus] = useState(\"waiting\");\n  const statusRef = useRef(status);\n  useEffect(() => {\n    statusRef.current = status;\n  }, [status]);\n  const [chatMessages, setChatMessages] = useState([]);\n  const [localSpeaking, setLocalSpeaking] = useState(false);\n  const [remoteSpeaking, setRemoteSpeaking] = useState(false);\n  const [remoteMuted, setRemoteMuted] = useState(false);\n\n  // --- SIGNALING WS SETUP ---\n  useEffect(() => {\n    if (!start) return;\n    const serverUrl = process.env.REACT_APP_SERVER_URL;\n    wsRef.current = new WebSocket(`${serverUrl.replace(/^http/, \"ws\")}?roomId=${callId}`);\n    wsRef.current.onopen = () => console.log(\"WS open\");\n    wsRef.current.onmessage = async ({\n      data\n    }) => {\n      let msg;\n      try {\n        msg = JSON.parse(data);\n      } catch {\n        return;\n      }\n      switch (msg.type) {\n        case \"room-status\":\n          if (msg.peers === 2 && statusRef.current === \"waiting\") await initiateCall(isInitiator);\n          break;\n        case \"offer\":\n          await pcRef.current.setRemoteDescription(msg.offer);\n          const answer = await pcRef.current.createAnswer();\n          await pcRef.current.setLocalDescription(answer);\n          wsRef.current.send(JSON.stringify({\n            type: \"answer\",\n            answer\n          }));\n          break;\n        case \"answer\":\n          await pcRef.current.setRemoteDescription(msg.answer);\n          break;\n        case \"candidate\":\n          await pcRef.current.addIceCandidate(msg.candidate);\n          break;\n        case \"peer-left\":\n          setStatus(\"peer-left\");\n          break;\n        case \"call-ended\":\n          setStatus(\"ended\");\n          break;\n      }\n    };\n    const timer = setTimeout(() => {\n      if (statusRef.current !== \"connected\") setStatus(\"timeout\");\n    }, timeout);\n    return () => {\n      var _wsRef$current, _pcRef$current;\n      clearTimeout(timer);\n      (_wsRef$current = wsRef.current) === null || _wsRef$current === void 0 ? void 0 : _wsRef$current.close();\n      (_pcRef$current = pcRef.current) === null || _pcRef$current === void 0 ? void 0 : _pcRef$current.close();\n    };\n  }, [callId, start, isInitiator]);\n\n  // --- PEER CONNECTION SETUP ---\n  async function initiateCall(isInitiator) {\n    setStatus(\"connecting\");\n    pcRef.current = new RTCPeerConnection({\n      iceServers: [{\n        urls: process.env.REACT_APP_STUN_SERVER\n      }]\n    });\n\n    // --- audio local + détection ---\n    localStreamRef.current = await navigator.mediaDevices.getUserMedia({\n      audio: true\n    });\n    const audioCtxL = new (window.AudioContext || window.webkitAudioContext)();\n    const analyserL = audioCtxL.createAnalyser();\n    const srcL = audioCtxL.createMediaStreamSource(localStreamRef.current);\n    srcL.connect(analyserL);\n    analyserL.fftSize = 256;\n    const dataL = new Uint8Array(analyserL.frequencyBinCount);\n    (function detectLocal() {\n      analyserL.getByteFrequencyData(dataL);\n      setLocalSpeaking(dataL.reduce((s, v) => s + v, 0) / dataL.length > 30);\n      requestAnimationFrame(detectLocal);\n    })();\n    localStreamRef.current.getTracks().forEach(t => pcRef.current.addTrack(t, localStreamRef.current));\n\n    // --- réception du flux distant ---\n    pcRef.current.ontrack = ({\n      streams: [stream]\n    }) => {\n      if (remoteAudioRef.current) {\n        remoteAudioRef.current.srcObject = stream;\n        // forcer la lecture\n        remoteAudioRef.current.play().catch(err => console.warn(\"Audio play failed:\", err));\n      }\n\n      // détection mute/unmute\n      const rt = stream.getAudioTracks()[0];\n      if (rt) {\n        rt.onmute = () => setRemoteMuted(true);\n        rt.onunmute = () => setRemoteMuted(false);\n      }\n\n      // détection de parole du pair\n      if (!remoteSpeaking) {\n        const audioCtxR = new (window.AudioContext || window.webkitAudioContext)();\n        const analyserR = audioCtxR.createAnalyser();\n        const srcR = audioCtxR.createMediaStreamSource(stream);\n        srcR.connect(analyserR);\n        analyserR.fftSize = 256;\n        const dataR = new Uint8Array(analyserR.frequencyBinCount);\n        (function detectRemote() {\n          analyserR.getByteFrequencyData(dataR);\n          setRemoteSpeaking(dataR.reduce((s, v) => s + v, 0) / dataR.length > 30);\n          requestAnimationFrame(detectRemote);\n        })();\n      }\n    };\n\n    // … reste identique (dataChannel, ICE, offer/answer) …\n\n    setStatus(\"connected\");\n  }\n  function setupDataChannel() {\n    dataChannelRef.current.onopen = () => console.log(\"DataChannel open\");\n    dataChannelRef.current.onmessage = ({\n      data\n    }) => {\n      let parsed;\n      try {\n        parsed = JSON.parse(data);\n      } catch {\n        /* not JSON? */\n      }\n      // handle mute signaling\n      if (parsed && parsed.type === \"mute\") {\n        setRemoteMuted(parsed.muted);\n        return;\n      }\n      // otherwise chat message\n      setChatMessages(prev => [...prev, {\n        sender: \"peer\",\n        text: data\n      }]);\n    };\n  }\n\n  // --- PUBLIC API ---\n  function sendMessage(text) {\n    var _dataChannelRef$curre;\n    if (((_dataChannelRef$curre = dataChannelRef.current) === null || _dataChannelRef$curre === void 0 ? void 0 : _dataChannelRef$curre.readyState) === \"open\") {\n      dataChannelRef.current.send(text);\n      setChatMessages(prev => [...prev, {\n        sender: \"local\",\n        text\n      }]);\n    }\n  }\n  function toggleMute() {\n    var _localStreamRef$curre, _dataChannelRef$curre2;\n    const track = (_localStreamRef$curre = localStreamRef.current) === null || _localStreamRef$curre === void 0 ? void 0 : _localStreamRef$curre.getAudioTracks()[0];\n    if (!track) return;\n    // flip track.enabled\n    track.enabled = !track.enabled;\n    // only the invitee sends their mute state to the host\n    if (!isInitiator && ((_dataChannelRef$curre2 = dataChannelRef.current) === null || _dataChannelRef$curre2 === void 0 ? void 0 : _dataChannelRef$curre2.readyState) === \"open\") {\n      dataChannelRef.current.send(JSON.stringify({\n        type: \"mute\",\n        muted: !track.enabled\n      }));\n    }\n  }\n  function hangUp() {\n    var _localStreamRef$curre2;\n    if (isInitiator) {\n      wsRef.current.send(JSON.stringify({\n        type: \"end-call\"\n      }));\n    }\n    setStatus(\"ended\");\n    (_localStreamRef$curre2 = localStreamRef.current) === null || _localStreamRef$curre2 === void 0 ? void 0 : _localStreamRef$curre2.getTracks().forEach(t => t.stop());\n    if (remoteAudioRef.current) remoteAudioRef.current.srcObject = null;\n    setTimeout(() => {\n      var _wsRef$current2, _pcRef$current2;\n      (_wsRef$current2 = wsRef.current) === null || _wsRef$current2 === void 0 ? void 0 : _wsRef$current2.close();\n      (_pcRef$current2 = pcRef.current) === null || _pcRef$current2 === void 0 ? void 0 : _pcRef$current2.close();\n    }, 100);\n  }\n  return {\n    remoteAudioRef,\n    status,\n    chatMessages,\n    sendMessage,\n    toggleMute,\n    hangUp,\n    localSpeaking,\n    remoteSpeaking,\n    remoteMuted\n  };\n}\n_s(useWebRTC, \"cKP1I0v2cUgvh4EjW4pVYio3St0=\");","map":{"version":3,"names":["useEffect","useRef","useState","useWebRTC","callId","timeout","start","isInitiator","_s","wsRef","pcRef","dataChannelRef","remoteAudioRef","localStreamRef","status","setStatus","statusRef","current","chatMessages","setChatMessages","localSpeaking","setLocalSpeaking","remoteSpeaking","setRemoteSpeaking","remoteMuted","setRemoteMuted","serverUrl","process","env","REACT_APP_SERVER_URL","WebSocket","replace","onopen","console","log","onmessage","data","msg","JSON","parse","type","peers","initiateCall","setRemoteDescription","offer","answer","createAnswer","setLocalDescription","send","stringify","addIceCandidate","candidate","timer","setTimeout","_wsRef$current","_pcRef$current","clearTimeout","close","RTCPeerConnection","iceServers","urls","REACT_APP_STUN_SERVER","navigator","mediaDevices","getUserMedia","audio","audioCtxL","window","AudioContext","webkitAudioContext","analyserL","createAnalyser","srcL","createMediaStreamSource","connect","fftSize","dataL","Uint8Array","frequencyBinCount","detectLocal","getByteFrequencyData","reduce","s","v","length","requestAnimationFrame","getTracks","forEach","t","addTrack","ontrack","streams","stream","srcObject","play","catch","err","warn","rt","getAudioTracks","onmute","onunmute","audioCtxR","analyserR","srcR","dataR","detectRemote","setupDataChannel","parsed","muted","prev","sender","text","sendMessage","_dataChannelRef$curre","readyState","toggleMute","_localStreamRef$curre","_dataChannelRef$curre2","track","enabled","hangUp","_localStreamRef$curre2","stop","_wsRef$current2","_pcRef$current2"],"sources":["/Users/theodiamant/Desktop/webrtc/client/src/hooks/useWebRTC.js"],"sourcesContent":["// src/hooks/useWebRTC.js\nimport { useEffect, useRef, useState } from \"react\";\n\nexport default function useWebRTC(\n  callId,\n  { timeout = 30000, start = true, isInitiator = false }\n) {\n  // --- refs & state ---\n  const wsRef = useRef();\n  const pcRef = useRef();\n  const dataChannelRef = useRef();\n  const remoteAudioRef = useRef();\n  const localStreamRef = useRef();\n\n  const [status, setStatus] = useState(\"waiting\");\n  const statusRef = useRef(status);\n  useEffect(() => {\n    statusRef.current = status;\n  }, [status]);\n\n  const [chatMessages, setChatMessages] = useState([]);\n  const [localSpeaking, setLocalSpeaking] = useState(false);\n  const [remoteSpeaking, setRemoteSpeaking] = useState(false);\n  const [remoteMuted, setRemoteMuted] = useState(false);\n\n  // --- SIGNALING WS SETUP ---\n  useEffect(() => {\n    if (!start) return;\n    const serverUrl = process.env.REACT_APP_SERVER_URL;\n    wsRef.current = new WebSocket(\n      `${serverUrl.replace(/^http/, \"ws\")}?roomId=${callId}`\n    );\n    wsRef.current.onopen = () => console.log(\"WS open\");\n    wsRef.current.onmessage = async ({ data }) => {\n      let msg;\n      try {\n        msg = JSON.parse(data);\n      } catch {\n        return;\n      }\n      switch (msg.type) {\n        case \"room-status\":\n          if (msg.peers === 2 && statusRef.current === \"waiting\")\n            await initiateCall(isInitiator);\n          break;\n        case \"offer\":\n          await pcRef.current.setRemoteDescription(msg.offer);\n          const answer = await pcRef.current.createAnswer();\n          await pcRef.current.setLocalDescription(answer);\n          wsRef.current.send(JSON.stringify({ type: \"answer\", answer }));\n          break;\n        case \"answer\":\n          await pcRef.current.setRemoteDescription(msg.answer);\n          break;\n        case \"candidate\":\n          await pcRef.current.addIceCandidate(msg.candidate);\n          break;\n        case \"peer-left\":\n          setStatus(\"peer-left\");\n          break;\n        case \"call-ended\":\n          setStatus(\"ended\");\n          break;\n      }\n    };\n    const timer = setTimeout(() => {\n      if (statusRef.current !== \"connected\") setStatus(\"timeout\");\n    }, timeout);\n    return () => {\n      clearTimeout(timer);\n      wsRef.current?.close();\n      pcRef.current?.close();\n    };\n  }, [callId, start, isInitiator]);\n\n  // --- PEER CONNECTION SETUP ---\n  async function initiateCall(isInitiator) {\n    setStatus(\"connecting\");\n    pcRef.current = new RTCPeerConnection({\n      iceServers: [{ urls: process.env.REACT_APP_STUN_SERVER }],\n    });\n\n    // --- audio local + détection ---\n    localStreamRef.current = await navigator.mediaDevices.getUserMedia({ audio: true });\n    const audioCtxL = new (window.AudioContext || window.webkitAudioContext)();\n    const analyserL = audioCtxL.createAnalyser();\n    const srcL = audioCtxL.createMediaStreamSource(localStreamRef.current);\n    srcL.connect(analyserL);\n    analyserL.fftSize = 256;\n    const dataL = new Uint8Array(analyserL.frequencyBinCount);\n    (function detectLocal() {\n      analyserL.getByteFrequencyData(dataL);\n      setLocalSpeaking(dataL.reduce((s, v) => s + v, 0) / dataL.length > 30);\n      requestAnimationFrame(detectLocal);\n    })();\n    localStreamRef.current.getTracks().forEach(t => pcRef.current.addTrack(t, localStreamRef.current));\n\n    // --- réception du flux distant ---\n    pcRef.current.ontrack = ({ streams: [stream] }) => {\n      if (remoteAudioRef.current) {\n        remoteAudioRef.current.srcObject = stream;\n        // forcer la lecture\n        remoteAudioRef.current\n          .play()\n          .catch(err => console.warn(\"Audio play failed:\", err));\n      }\n\n      // détection mute/unmute\n      const rt = stream.getAudioTracks()[0];\n      if (rt) {\n        rt.onmute = () => setRemoteMuted(true);\n        rt.onunmute = () => setRemoteMuted(false);\n      }\n\n      // détection de parole du pair\n      if (!remoteSpeaking) {\n        const audioCtxR = new (window.AudioContext || window.webkitAudioContext)();\n        const analyserR = audioCtxR.createAnalyser();\n        const srcR = audioCtxR.createMediaStreamSource(stream);\n        srcR.connect(analyserR);\n        analyserR.fftSize = 256;\n        const dataR = new Uint8Array(analyserR.frequencyBinCount);\n        (function detectRemote() {\n          analyserR.getByteFrequencyData(dataR);\n          setRemoteSpeaking(dataR.reduce((s, v) => s + v, 0) / dataR.length > 30);\n          requestAnimationFrame(detectRemote);\n        })();\n      }\n    };\n\n    // … reste identique (dataChannel, ICE, offer/answer) …\n\n    setStatus(\"connected\");\n  }\n\n  function setupDataChannel() {\n    dataChannelRef.current.onopen = () => console.log(\"DataChannel open\");\n    dataChannelRef.current.onmessage = ({ data }) => {\n      let parsed;\n      try {\n        parsed = JSON.parse(data);\n      } catch {\n        /* not JSON? */\n      }\n      // handle mute signaling\n      if (parsed && parsed.type === \"mute\") {\n        setRemoteMuted(parsed.muted);\n        return;\n      }\n      // otherwise chat message\n      setChatMessages((prev) => [...prev, { sender: \"peer\", text: data }]);\n    };\n  }\n\n  // --- PUBLIC API ---\n  function sendMessage(text) {\n    if (dataChannelRef.current?.readyState === \"open\") {\n      dataChannelRef.current.send(text);\n      setChatMessages((prev) => [...prev, { sender: \"local\", text }]);\n    }\n  }\n\n  function toggleMute() {\n    const track = localStreamRef.current?.getAudioTracks()[0];\n    if (!track) return;\n    // flip track.enabled\n    track.enabled = !track.enabled;\n    // only the invitee sends their mute state to the host\n    if (!isInitiator && dataChannelRef.current?.readyState === \"open\") {\n      dataChannelRef.current.send(\n        JSON.stringify({ type: \"mute\", muted: !track.enabled })\n      );\n    }\n  }\n\n  function hangUp() {\n    if (isInitiator) {\n      wsRef.current.send(JSON.stringify({ type: \"end-call\" }));\n    }\n    setStatus(\"ended\");\n    localStreamRef.current?.getTracks().forEach((t) => t.stop());\n    if (remoteAudioRef.current) remoteAudioRef.current.srcObject = null;\n    setTimeout(() => {\n      wsRef.current?.close();\n      pcRef.current?.close();\n    }, 100);\n  }\n\n  return {\n    remoteAudioRef,\n    status,\n    chatMessages,\n    sendMessage,\n    toggleMute,\n    hangUp,\n    localSpeaking,\n    remoteSpeaking,\n    remoteMuted,\n  };\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}